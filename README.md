# Домашнее задание к занятию «Резервное копирование баз данных»
## Косарев Д.О.

---

## Задание 1. Резервное копирование

### 1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день

Для этого подходит ежедневное полное резервное копирование (Full Backup).

Обоснование:
- Создается полная копия всех данных на момент окончания дня
- Восстановление выполняется из одного файла/архива
- Минимальная сложность администрирования
- Высокая скорость восстановления

Рекомендации:
- Выполнение в период минимальной нагрузки (например, 00:00-03:00)
- Хранение на отдельном носителе или в облаке
- Регулярная проверка целостности бэкапов

### 1.2. Необходимо восстанавливать данные за час до предполагаемой поломки

Для этого требуется многоуровневая стратегия с Point-in-Time Recovery (PITR).

Трехуровневая схема:
1. Полные бэкапы - 1 раз в сутки
2. Инкрементные бэкапы - каждые 2-4 часа
3. Журналы транзакций - непрерывная архивация

Техническая реализация:
- 00:00 - Полный бэкап
- 04:00 - Инкрементный бэкап
- 08:00 - Инкрементный бэкап
- 12:00 - Инкрементный бэкап
- 16:00 - Инкрементный бэкап
- 20:00 - Инкрементный бэкап
- + Непрерывная архивация журналов (каждые 5-10 минут)

Процесс восстановления:
1. Восстановить последний полный бэкап
2. Применить все инкрементные бэкапы после него
3. Применить журналы транзакций до нужного момента

---

## Задание 2. PostgreSQL

### 2.1. Примеры команд резервирования и восстановления

Создание резервной копии:

КОМАНДА:
pg_dump -U postgres -d production_db -F c -v -Z 9 -f /backup/db_$(date +%Y%m%d).dump

ОПЦИИ:
- -U postgres - пользователь PostgreSQL
- -d production_db - база данных для резервирования
- -F c - формат custom (поддерживает сжатие)
- -v - выводит информацию о выполнении
- -Z 9 - максимальное сжатие
- -f - файл для сохранения

Восстановление базы данных:

КОМАНДЫ:
pg_restore -U postgres -d restored_db /backup/db_20240115.dump
pg_restore -U postgres -d new_db --schema-only /backup/db_20240115.dump
pg_restore -U postgres -d existing_db --data-only /backup/db_20240115.dump
pg_restore -U postgres -d database --table=users --table=orders /backup/db_20240115.dump

---

## Задание 3. MySQL

### 3.1. Пример инкрементного резервного копирования

Настройка MySQL:

КОНФИГУРАЦИЯ в /etc/mysql/my.cnf:
[mysqld]
server-id = 1
log-bin = /var/log/mysql/mysql-bin.log
binlog-format = ROW
expire-logs-days = 7
max_binlog_size = 100M

Полное резервное копирование:

КОМАНДА:
mysqldump -u backup_user -p'password' --single-transaction --flush-logs --master-data=2 --all-databases --routines --events --triggers > /backup/full_$(date +%Y%m%d).sql

Инкрементное копирование:

КОМАНДА:
cp /var/log/mysql/mysql-bin.* /backup/incremental/

Восстановление:

КОМАНДЫ:
mysql -u root -p < /backup/full_20240115.sql
mysqlbinlog /backup/incremental/mysql-bin.* | mysql -u root -p
mysqlbinlog --stop-datetime="2024-01-15 14:30:00" /backup/incremental/mysql-bin.* | mysql -u root -p
